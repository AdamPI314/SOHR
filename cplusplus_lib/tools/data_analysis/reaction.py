import re


########################################################################################################################
class reaction_c:
    """
    bundle reactions stuff
    """
    # backward and forward reactions
    # remove duplicated reaction
    # number of Hydrogen atoms
    rxns_factor = {0: 1, 1: 1, 2: 2, 3: 2, 4: 3, 5: 3, 6: 2, 7: 2, 8: 2, 9: 2, 10: 0, 11: 0, 12: 1, 13: 1, 14: 2, 15: 2,
                   16: 1, 17: 1, 18: 2, 19: 2, 20: 2, 21: 2, \
                   22: 1, 23: 1, 24: 2, 25: 2, 26: 2, 27: 2, 28: 2, 29: 2, 30: 2, 31: 2, 32: 3, 33: 3, 34: 3, 35: 3,
                   36: 2, 37: 2, 38: 3, 39: 3, 40: 3, 41: 3}

    # static variables
    # reaction pair index sequence
    index_pair = \
        [(0, 1), (0, 2), (0, 3), (0, 4), (0, 5), (0, 6), (0, 7), (0, 8), (0, 9), (0, 10), (0, 11), (0, 12), (0, 13),
         (0, 14), (0, 15), \
         (0, 16), (0, 17), (0, 18), (1, 2), (1, 3), (1, 4), (1, 5), (1, 6), (1, 7), (1, 8), (1, 9), \
         (1, 10), (1, 11), (1, 12), (1, 13), (1, 14), (1, 15), (1, 16), (1, 17), (1, 18), (2, 3), \
         (2, 4), (2, 5), (2, 6), (2, 7), (2, 8), (2, 9), (2, 10), (2, 11), (2, 12), (2, 13), (2, 14), (2, 15), (2, 16),
         (2, 17), (2, 18), \
         (3, 4), (3, 5), (3, 6), (3, 7), (3, 8), (3, 9), (3, 10), (3, 11), (3, 12), (3, 13), (3, 14), \
         (3, 15), (3, 16), (3, 17), (3, 18), (4, 5), (4, 6), (4, 7), (4, 8), (4, 9), (4, 10), (4, 11), \
         (4, 12), (4, 13), (4, 14), (4, 15), (4, 16), (4, 17), (4, 18), (5, 6), (5, 7), (5, 8), (5, 9), \
         (5, 10), (5, 11), (5, 12), (5, 13), (5, 14), (5, 15), (5, 16), (5, 17), (5, 18), (6, 7), (6, 8), \
         (6, 9), (6, 10), (6, 11), (6, 12), (6, 13), (6, 14), (6, 15), (6, 16), (6, 17), (6, 18), (7, 8), \
         (7, 9), (7, 10), (7, 11), (7, 12), (7, 13), (7, 14), (7, 15), (7, 16), (7, 17), (7, 18), (8, 9), \
         (8, 10), (8, 11), (8, 12), (8, 13), (8, 14), (8, 15), (8, 16), (8, 17), (8, 18), (9, 10), (9, 11), \
         (9, 12), (9, 13), (9, 14), (9, 15), (9, 16), (9, 17), (9, 18), (10, 11), (10, 12), (10, 13), \
         (10, 14), (10, 15), (10, 16), (10, 17), (10, 18), (11, 12), (11, 13), (11, 14), (11, 15), \
         (11, 16), (11, 17), (11, 18), (12, 13), (12, 14), (12, 15), (12, 16), (12, 17), (12, 18), \
         (13, 14), (13, 15), (13, 16), (13, 17), (13, 18), \
         (14, 15), (14, 16), (14, 17), (14, 18), (15, 16), (15, 17), (15, 18), \
         (16, 17), (16, 18), (17, 18)]

    # reaction index without duplicated reaction
    # mapped_rxn_ind= [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 19, 20, 21, 22, 23]
    mapped_rxn_ind = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 15, 16, 17, 18, 19]

    # reaction details
    rxns = {0: "H+O2=O+OH", 1: "O+H2=H+OH", 2: "H2+OH=H2O+H", 3: "O+H2O=OH+OH", 4: "H2+M=H+H+M", \
            5: "O+O+M=O2+M", 6: "O+H+M=OH+M", 7: "H+OH+M=H2O+M", 8: "H+O2(+M)=HO2(+M)", \
            9: "HO2+H=H2+O2", 10: "HO2+H=OH+OH", 11: "HO2+O=O2+OH", 12: "HO2+OH=H2O+O2", 13: "HO2+HO2=H2O2+O2",
            14: "HO2+HO2=H2O2+O2", \
            15: "H2O2(+M)=OH+OH(+M)", 16: "H2O2+H=H2O+OH", 17: "H2O2+H=HO2+H2", 18: "H2O2+O=OH+HO2",
            19: "H2O2+OH=HO2+H2O", \
            20: "H2O2+OH=HO2+H2O"}

    rxns_latex = {0: "$H+O_2=O+OH$", 1: "$O+H_2=H+OH$", 2: "$H_2+OH=H_2O+H$", 3: "$O+H_2O=OH+OH$", 4: "$H_2+M=H+H+M$", \
                  5: "$O+O+M=O_2+M$", 6: "$O+H+M=OH+M$", 7: "$H+OH+M=H_2O+M$", 8: "$H+O_2(+M)=HO_2(+M)$", \
                  9: "$HO_2+H=H_2+O_2$", 10: "$HO_2+H=OH+OH$", 11: "$HO_2+O=O_2+OH$", 12: "$HO_2+OH=H_2O+O_2$",
                  13: "$HO_2+HO_2=H_2O_2+O_2$", 14: "$HO_2+HO_2=H_2O_2+O_2$", \
                  15: "$H_2O_2(+M)=OH+OH(+M)$", 16: "$H_2O_2+H=H_2O+OH$", 17: "$H_2O_2+H=HO_2+H_2$",
                  18: "$H_2O_2+O=OH+HO_2$", 19: "$H_2O_2+OH=HO_2+H_2O$", \
                  20: "$H_2O_2+OH=HO_2+H_2O$"}

    old_new_label_static = {"0": "0", "1": "0*", "2": "1", "3": "1*", "4": "2", "5": "2*", "6": "3", "7": "3*",
                            "8": "4", "9": "4*", "10": "5", "11": "5*" \
        , "12": "6", "13": "6*", "14": "7", "15": "7*", "16": "8", "17": "8*", "18": "9", "19": "9*", "20": "10",
                            "21": "10*" \
        , "22": "11", "23": "11*", "24": "12", "25": "12*", "26": "13", "27": "13*", "28": "15", "29": "15*",
                            "30": "16", "31": "16*" \
        , "32": "17", "33": "17*", "34": "18", "35": "18*", "36": "19", "37": "19*"}

    def dashrepl(self, matchobj):
        return self.old_new_label[matchobj.group(0)]

    def re_label_index(self, in_str):
        return re.sub("(?<=R)\d+", self.dashrepl, in_str)

    # return top N element and their index
    @staticmethod
    def topN_element_and_index(self, in_list, topN=3):
        #     by using dict, will delete duplicated items
        #     dict_t= {in_list[i]:i for i in xrange(len(in_list))}
        #     dict_t2= sorted(dict_t.items(), key=lambda x: x[0], reverse=True)
        dict_t = [(in_list[i], i) for i in xrange(len(in_list))]
        dict_t2 = sorted(dict_t, reverse=True)
        ele = [x[0] for x in dict_t2[0:topN]]
        ind = [x[1] for x in dict_t2[0:topN]]
        return ele, ind

    def __init__(self):
        # reaction index re-label, backward reaction labelled with labelling of forward reaction plus '*'
        self.old_new_label = {"0": "0", "1": "0*", "2": "1", "3": "1*", "4": "2", "5": "2*", "6": "3", "7": "3*",
                              "8": "4", "9": "4*", "10": "5", "11": "5*" \
            , "12": "6", "13": "6*", "14": "7", "15": "7*", "16": "8", "17": "8*", "18": "9", "19": "9*", "20": "10",
                              "21": "10*" \
            , "22": "11", "23": "11*", "24": "12", "25": "12*", "26": "13", "27": "13*", "28": "15", "29": "15*",
                              "30": "16", "31": "16*" \
            , "32": "17", "33": "17*", "34": "18", "35": "18*", "36": "19", "37": "19*"}
